(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{kG:()=>Y,zl:()=>Q,bG:()=>m,ER:()=>f,DQ:()=>U,oP:()=>P,vi:()=>A,E0:()=>O,xS:()=>z});var t={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"e85e6001-6fbf-4aaa-b4c1-c70dfc51e061","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c),document.addEventListener("mousedown",u)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c),document.removeEventListener("mousedown",u)}function c(e){"Escape"===e.key&&O.forEach((function(e){e.classList.contains("popup_opened")&&r(e)}))}function u(e){Y(e.target)}function i(e){var r=m.cloneNode(!0),c=r.querySelector(".element__header"),u=r.querySelector(".element__img"),i=r.querySelector(".element__like-num"),a=r.querySelector(".element__like-button"),l=r.querySelector(".element__delete-button");return u.addEventListener("click",(function(){o(A),P.src=e.link,P.alt=e.name,U.textContent=e.name})),l.addEventListener("click",(function(){var o;(o=e._id,fetch("".concat(t.baseUrl,"/cards/").concat(o),{headers:t.headers,method:"DELETE"}).then(n)).then((function(){return r.remove()})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){var o,r;a.classList.contains("element__like-button_active")?(o=e._id,r=e.likes,fetch("".concat(t.baseUrl,"/cards/likes/").concat(o),{headers:t.headers,method:"DELETE",body:JSON.stringify({likes:r})}).then(n)).then((function(e){a.classList.remove("element__like-button_active"),i.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e,o){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{headers:t.headers,method:"PUT",body:JSON.stringify({likes:o})}).then(n)}(e._id,e.likes).then((function(e){a.classList.add("element__like-button_active"),i.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),e.likes.find((function(e){return e._id===z}))?a.classList.add("element__like-button_active"):a.classList.remove("element__like-button_active"),Q(e,l),c.textContent=e.name,u.src=e.link,u.alt=e.name,i.textContent=e.likes.length,r}function a(e){f.prepend(e)}function l(e){e.disabled=!0}function s(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e){e.disabled=!1}(t):l(t)}var d,p={formSelector:".popup__form",inputSelector:".popup__input",buttonSelector:".popup__button-submit",invalidInputClass:"popup__input_invalid"},f=document.querySelector(".elements-grid__container"),m=document.querySelector(".template-element").content.querySelector(".element"),_=document.querySelector(".profile__name"),v=document.querySelector(".profile__about-you"),y=document.querySelector(".profile__button-edit"),h=document.querySelector(".popup__edit-profile"),b=h.querySelector(".popup__form"),S=b.querySelector("#username"),q=b.querySelector("#aboutYou"),E=b.querySelector(".popup__button-submit"),L=document.querySelector(".profile__button-add"),k=document.querySelector(".popup__add-place"),g=k.querySelector(".popup__form"),C=g.querySelector("#titlePic"),x=g.querySelector("#urlPic"),T=g.querySelector(".popup__button-submit"),A=document.querySelector(".popup__open-image"),P=A.querySelector(".popup__image"),U=A.querySelector(".popup__caption"),O=Array.from(document.querySelectorAll(".popup")),w=document.querySelector(".profile__avatar"),D=document.querySelector(".profile__img"),I=document.querySelector(".popup__edit-avatar"),N=I.querySelector(".popup__form"),j=N.querySelector("#urlAvatar"),J=N.querySelector(".popup__button-submit"),z="",B=document.querySelectorAll(".popup__button-close"),G=Array.from(h.querySelectorAll(".error_input-text"));function H(e){_.textContent=e.name,v.textContent=e.about}function M(e){w.src=e.avatar}function Q(e,t){e.owner._id===z&&t.classList.remove("delete-button_disable")}function R(e,t){e.querySelector(".popup__button-submit").textContent=t}function Y(e){e===h?r(h):e===k?r(k):e===A?r(A):e===I&&r(I)}b.addEventListener("submit",(function(e){var o;e.preventDefault(),(o={name:S.value,about:q.value},fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o.name,about:o.about})}).then(n)).then((function(e){H(e),R(h,"Сохранение..."),setTimeout((function(){return r(h)}),500)})).catch((function(e){console.log(e)})).finally((function(){return setTimeout((function(){return h.querySelector(".popup__button-submit").textContent="Сохранить"}),500)}))})),y.addEventListener("click",(function(){o(h),S.value=_.textContent,q.value=v.textContent,G.forEach((function(e){return e.textContent=""})),S.classList.remove(p.invalidInputClass),q.classList.remove(p.invalidInputClass),E.disabled=!1})),g.addEventListener("submit",(function(e){var o,c;e.preventDefault(),(o=C.value,c=x.value,fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers,method:"POST",body:JSON.stringify({name:o,link:c})}).then(n)).then((function(t){a(i(t)),R(k,"Создание..."),setTimeout((function(){r(k),e.target.reset(),T.disabled=!0}),500)})).catch((function(e){console.log(e)})).finally((function(){return setTimeout((function(){return k.querySelector(".popup__button-submit").textContent="Создать"}),500)}))})),L.addEventListener("click",(function(){return o(k)})),N.addEventListener("submit",(function(e){var o;e.preventDefault(),(o=j.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(t){M(t),R(I,"Сохранение..."),setTimeout((function(){r(I),e.target.reset(),J.disabled=!0}),500)})).catch((function(e){console.log(e)})).finally((function(){return setTimeout((function(){return I.querySelector(".popup__button-submit").textContent="Сохранить"}),500)}))})),D.addEventListener("click",(function(){return o(I)})),B.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return r(t)}))})),d=p,Array.from(document.querySelectorAll(d.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.buttonSelector);s(n,o),e.addEventListener("reset",(function(){return l(o)})),n.forEach((function(e){return e.addEventListener("input",(function(){(function(e,t){e.validity.valid?function(e,t){var n="error-"+e.id;document.getElementById(n).textContent="",e.classList.remove(t.invalidInputClass)}(e,t):function(e,t,n){var o="error-"+e.id;document.getElementById(o).textContent=t,e.classList.add(n.invalidInputClass)}(e,e.validationMessage,t)})(e,t),s(n,o)}))})),e.addEventListener("reset",(function(){return l(o)}))}(e,d)})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(e){z=e._id,H(e),M(e)})).catch((function(e){console.log(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){e.forEach((function(e){a(i(e))}))})).catch((function(e){console.log(e)}))})();